%%%%%%%%%%%%%%%%%%%%%%
%%% Initialization %%%
%%%%%%%%%%%%%%%%%%%%%%

\ProvidesExplFile{expl-lua}{2024-99-99}{0.0.1}{Lua expl3 functions}

%% Load the Lua module
\lua_load_module:n { expl-lua }


%%%%%%%%%%%%%%%%%%%%%%
%%% Property Lists %%%
%%%%%%%%%%%%%%%%%%%%%%

%% Macro wrappers
\cs_new:Nn \lprop_new:N {
    \exp_after:wN \__lprop_new:N \exp_not:N #1
}

\cs_set_eq:NN \lprop_clear_new:N \lprop_new:N
\cs_set_eq:NN \lprop_gclear_new:N \lprop_new:N

\cs_generate_variant:Nn \lprop_gput:Nnn { Nne, NnV }
\cs_generate_variant:Nn \lprop_put:Nnn { Nne, NnV }

\cs_set_eq:NN \lprop_set_eq:NN  \tex_let:D
\cs_set_eq:NN \lprop_gset_eq:NN \tex_let:D

\cs_new:Npn \lprop_set_from_keyval:Nn #1 {
    \lprop_clear:N #1
    \lprop_put_from_keyval:Nn #1
}

\cs_new:Npn \lprop_gset_from_keyval:Nn #1 {
    \lprop_gclear:N #1
    \lprop_gput_from_keyval:Nn #1
}

\cs_set_eq:NN \lprop_const_from_keyval:Nn \lprop_gset_from_keyval:Nn

\cs_new:Nn \lprop_get:NnN {
    \tl_set:No #3 { \lprop_item:Nn #1 { #2 } }
}

\cs_new:Nn \lprop_pop:NnN {
    \lprop_get:NnN #1 { #2 } #3
    \lprop_remove:Nn #1 { #2 }
}

\cs_new:Nn \lprop_gpop:NnN {
    \lprop_get:NnN #1 { #2 } #3
    \lprop_gremove:Nn #1 { #2 }
}

\cs_new:Nn \lprop_map_inline:Nn {
    \cs_set:Nn \__lprop_mapper:nn { #2 }
    \lprop_map_function:NN #1 \__lprop_mapper:nn
}
