%%%%%%%%%%%%%%%%%%%%%%
%%% Initialization %%%
%%%%%%%%%%%%%%%%%%%%%%

\ProvidesExplFile{expl-lua}{2024-99-99}{0.0.1}{Lua expl3 functions}

%% Load the Lua module
\lua_load_module:n { expl-lua }


%%%%%%%%%%%%%%%%%%%%%%
%%% Property Lists %%%
%%%%%%%%%%%%%%%%%%%%%%

%% Internal marker for a Lua property list
\scan_new:N \s__lprop

%% Macro wrappers
\cs_new:Nn \lprop_new:N {
    \tl_set_eq:NN #1 \s__lprop
    \__lprop_new:N #1
}

\cs_new:Nn \lprop_gclear_new:N {
    \tl_set_eq:NN #1 \s__lprop
    \lprop_gclear:N #1
}

\cs_generate_variant:Nn \lprop_gput:Nnn { Nne, NnV }

\cs_new:Npn \lprop_gset_from_keyval:Nn #1 {
    \lprop_gclear:N #1
    \lprop_gput_from_keyval:Nn #1
}

\cs_set_eq:NN \lprop_const_from_keyval:Nn \lprop_gset_from_keyval:Nn

\cs_new:Nn \lprop_get:NnN {
    \tl_set:No #3 { \lprop_item:Nn #1 { #2 } }
}

\cs_new:Nn \lprop_gpop:NnN {
    \lprop_get:NnN #1 { #2 } #3
    \lprop_gremove:Nn #1 { #2 }
}

\cs_new:Nn \lprop_map_inline:Nn {
    \cs_set:Nn \__lprop_mapper:nn { #2 }
    \lprop_map_function:NN #1 \__lprop_mapper:nn
}
