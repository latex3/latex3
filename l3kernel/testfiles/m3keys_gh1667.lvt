%
% Copyright (C) The LaTeX Project
%

\input{regression-test}

\ExplSyntaxOn
\debug_on:n { check-declarations , deprecation , log-functions }
\ExplSyntaxOff

\START

\OMIT
\ExplSyntaxOn
\keys_define:nn { moduleA }
  {
    test .code:n = \TYPE { used~ moduleA/test }
  }
\keys_define:nn { moduleB }
  {
     multi .multichoice:,
    ,multi / A .code:n = \TYPE { used~ moduleB/multi/A }
    ,multi / B .code:n =
      \TYPE { used~ moduleB/multi/B }
      \keys_set:nn { moduleA } { test }
    ,multi / C .code:n =
      \TYPE { used~ moduleB/multi/C }
      \keys_define:nn  { moduleA } { sub-path .inherit:n = { moduleC } }
    ,multi / D .code:n =
      \TYPE { used~ moduleB/multi/D }
      \keys_set:nn { moduleA/sub-path } { key-a }
  }
\keys_define:nn { moduleC }
  {
    key-a .code:n = \TYPE { used~ moduleC/key-a }
  }
\TIMO

\TEST { nested-set }
  {
    \keys_set:nn { moduleB } { multi = { B, A } }
  }

\TEST { nested-inherit-define }
  {
    \keys_set:nn { moduleB } { multi = { C, A } }
  }

\OMIT
\keys_define:nn  { moduleA } { sub-path .inherit:n = { moduleC } }
\TIMO

\TEST { nested-set-inherit }
  {
    \keys_set:nn { moduleB } { multi = { D, A } }
  }

\END
