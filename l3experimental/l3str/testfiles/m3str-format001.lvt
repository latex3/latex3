%
% Copyright (C) 2012 LaTeX3 Project
%

\documentclass{minimal}
\input{regression-test}
\RequirePackage[log-functions, check-declarations]{expl3}
\RequirePackage{l3str-format}

\begin{document}

\START
\AUTHOR{Bruno Le Floch}
\ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TESTEXP { Formatting~token~lists }
  {
    | \tl_format:nn { abcdef } {          } | \NEWLINE
    | \tl_format:nn { abcdef } {    9     } | \NEWLINE
    | \tl_format:nn { abcdef } {   18     } | \NEWLINE
    | \tl_format:nn { abcdef } {    8.3   } | \NEWLINE
    | \tl_format:nn { abcdef } {  < 8.3   } | \NEWLINE
    | \tl_format:nn { abcdef } {  ^ 8.3   } | \NEWLINE
    | \tl_format:nn { abcdef } {  > 8.3   } | \NEWLINE
    | \tl_format:nn { abcdef } { .< 8.3   } | \NEWLINE
    | \tl_format:nn { abcdef } { .^ 8.3   } | \NEWLINE
    | \tl_format:nn { abcdef } { .> 8.3 s } | \NEWLINE
    | \tl_format:nn { abcdef } { >> 8.3 s } | \NEWLINE
    | \tl_format:nn { abcdef } { ^< 8.3 s } | \NEWLINE
    | \tl_format:nn { abcdef } { ^< 8.0 s } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TESTEXP { Formatting~token~list~(empty~and~spaces) }
  {
    | \tl_format:nn { } {          } | \NEWLINE
    | \tl_format:nn { } {    9     } | \NEWLINE
    | \tl_format:nn { } {   18     } | \NEWLINE
    | \tl_format:nn { } {    8.3   } | \NEWLINE
    | \tl_format:nn { } {  < 8.3   } | \NEWLINE
    | \tl_format:nn { } {  ^ 8.3   } | \NEWLINE
    | \tl_format:nn { } {  > 8.3   } | \NEWLINE
    | \tl_format:nn {~} { .< 8.3   } | \NEWLINE
    | \tl_format:nn {~} { .^ 8.3   } | \NEWLINE
    | \tl_format:nn {~} { .> 8.3 s } | \NEWLINE
    | \tl_format:nn {~} { >> 8.3 s } | \NEWLINE
    | \tl_format:nn {~} { ^< 8.3 s } | \NEWLINE
    | \tl_format:nn {~} { ^< 8.0 s } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TESTEXP { Invalid~formattings~for~token~lists }
  {
    | \tl_format:nn { abcdef } { =  } | \NEWLINE
    | \tl_format:nn { abcdef } { +  } | \NEWLINE
    | \tl_format:nn { abcdef } { ~  } | \NEWLINE
    | \tl_format:nn { abcdef } { -  } | \NEWLINE
    | \tl_format:nn { abcdef } { .- } | \NEWLINE
    | \tl_format:nn { abcdef } { ?  } | \NEWLINE % no error :(
    | \tl_format:nn { abcdef } { < > . . } | \NEWLINE
    | \tl_format:nn { abcdef } { + 8.3 t } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\seq_set_split:Nnn \l_tmpa_seq { , } { abc , defghij , k }
\TESTEXP { Formatting~sequences }
  {
    | \seq_format:Nn \l_tmpa_seq {          } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq {    9     } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq {   18     } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq {    8.3   } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq {  < 8.3   } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq {  ^ 8.3   } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq {  > 8.3   } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq { .< 8.3   } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq { .^ 8.3   } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq { .> 8.3 s } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq { >> 8.3 s } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq { ^< 8.3 s } | \NEWLINE
    | \seq_format:Nn \l_tmpa_seq { ^< 8.0 s } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\int_set:Nn \l_tmpa_int { 123456 }
\TESTEXP { Formatting~positive~integers }
  {
    | \int_format:Nn \l_tmpa_int {            } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {      9     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {     18   b } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {     18   o } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  <   8   X } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  ^   8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  > + 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .< + 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .^ - 8     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .> - 8     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { >> ~ 8   o } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { ^< ~ 8   X } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { ^< + 8     } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\int_set:Nn \l_tmpa_int { -123456 }
\TESTEXP { Formatting~negative~integers }
  {
    | \int_format:Nn \l_tmpa_int {            } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {      9     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {     18   b } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {     18   o } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  <   8   X } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  ^   8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  > + 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .< + 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .^ - 8     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .> - 8     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { >> ~ 8   o } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { ^< ~ 8   X } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { ^< + 8     } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\int_set:Nn \l_tmpa_int { 0 }
\TESTEXP { Formatting~the~integer~0 }
  {
    | \int_format:Nn \l_tmpa_int {            } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {      9     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {     18   b } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {     18   o } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {    < 8   X } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {    ^ 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int {  > + 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .< + 8   d } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .^ - 8     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { .> - 8     } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { >> ~ 8   o } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { ^< ~ 8   X } | \NEWLINE
    | \int_format:Nn \l_tmpa_int { ^< + 8     } | \NEWLINE
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\TESTEXP { Formatting~integer~expression }
  {
    | \int_format:nn { "4D3 + "E } { X } | \NEWLINE
    | \int_format:nn { 1 - ( 4 + 5 + 6 ) * 2 } { < 5 } | \NEWLINE
    | \int_format:nn { 123456789 } { + 4 } | \NEWLINE
    | \int_format:nn { 123456789 } { - 4 } | \NEWLINE
    | \int_format:nn { 123456789 } { ~ 4 } | \NEWLINE
    | \int_format:nn { -123456789 } { + 4 } | \NEWLINE
    | \int_format:nn { -123456789 } { < < - 4 } | \NEWLINE
    | \int_format:nn { -123456789 } { . < ~ 4 } | \NEWLINE
  }

\END
